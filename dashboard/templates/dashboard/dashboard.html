{% extends "base.html" %}

{% block content %}
    <style>
        .messages {
            list-style: none;
            padding: 0;
        }
        .messages li {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .messages .error {
            color: red;
            background-color: #fdd;
        }
        .messages .success {
            color: green;
            background-color: #dfd;
        }
    </style>

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

  <h1>Dashboard</h1>

<!-- Include Display Emails section -->
<div class="display-emails">
    <h2>Display Emails</h2>
    {% if unread_emails %}
        {% for email in unread_emails %}
            <div class="email-item">
                <p>Subject: {{ email.subject }}</p>
                <p>From: {{ email.sender }}</p>
                <p>Snippet: {{ email.snippet }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p>No unread emails</p>
    {% endif %}
</div>

  
  <!-- Map Section -->
  <div id="map" style="height: 500px; width: 100%; margin-bottom: 20px;"></div>
  
  <!-- Unread Emails Section -->
  <section style="background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 20px; margin-top: 20px;">
    <h2 style="font-size: 1.5rem; color: #333;">Unread Emails ({{ unread_email_count }})</h2>
    <ul style="list-style-type: none; padding: 0; margin: 0;">
        {% for email in unread_emails %}
            <li style="border-bottom: 1px solid #ddd; padding: 10px 0; 
                        background-color: {% if 'unfortunately' in email.snippet|lower %} #ffdddd {% else %} #ffffff {% endif %};">
                <p style="margin: 0; font-size: 1rem; color: #555;">{{ email.sender }}</p>
                <p style="margin: 0; font-size: 0.9rem; color: #777;">{{ email.date }}</p>
                <p style="margin: 0; font-size: 1rem; color: #555;">{{ email.snippet }}</p>
            </li>
        {% empty %}
            <li style="padding: 10px; color: #888;">No unread emails found.</li>
        {% endfor %}
    </ul>
  </section>

  <script src="https://maps.googleapis.com/maps/api/js?key={{ key }}"></script>
  <script>
    function initMap() {
      const locations = {{ locations|safe }};
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: { lat: locations[0].lat, lng: locations[0].lng }
      });

      locations.forEach(location => {
        new google.maps.Marker({
          position: { lat: location.lat, lng: location.lng },
          map: map,
          title: location.name
        });
      });
    }

    window.onload = initMap;
  </script>
{% endblock %}

